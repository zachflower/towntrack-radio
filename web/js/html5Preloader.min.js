var html5Preloader=(function(){var j=typeof XMLHttpRequest==="undefined"?function(){try{return new ActiveXObject("Msxml2.XMLHTTP.6.0")}catch(q){}try{return new ActiveXObject("Msxml2.XMLHTTP.3.0")}catch(p){}return null}:XMLHttpRequest,i=typeof Audio!=="undefined"?function(){return new Audio()}:function(){return document.createElement("audio")},k=typeof Video!=="undefined"?function(){return new Video()}:function(){return document.createElement("video")},d=function(){return new Image()},c={oga:{codec:'audio/ogg; codecs="vorbis"',media:"audio"},wav:{codec:'audio/wav; codecs="1"',media:"audio"},webma:{codec:'audio/webm; codecs="vorbis"',media:"audio"},mp3:{codec:'audio/mpeg; codecs="mp3"',media:"audio"},m4a:{codec:'audio/mp4; codecs="mp4a.40.2"',media:"audio"},ogv:{codec:'video/ogg; codecs="theora, vorbis"',media:"video"},webmv:{codec:'video/webm; codecs="vorbis, vp8"',media:"video"},m4v:{codec:'video/mp4; codecs="avc1.42E01E, mp4a.40.2"',media:"video"}},n={imageTypes:["jpg","png","jpeg","tiff","gif"]},f="FILE@";c.ogg=c.oga;c.mp4=c.m4v;c.webm=c.webmv;function h(r,q){for(var p=0;p<q.length;p++){if(q[p]===r){return true}}return false}function a(p,t){if(p.map){return p.map(t)}var s=[],q;for(q=0;q<p.length;q++){s.push(t(p[q]))}return s}function l(q,p){return q.bind?q.bind(p):function(){return q.apply(p,arguments)}}function g(q){var p=[].slice.call(arguments,1);setTimeout(function(){q.apply(this,p)},0)}function o(){var p;for(p in o.prototype){if(o.prototype.hasOwnProperty(p)){this[p]=o.prototype[p]}}this._listeners={}}o.prototype={_listeners:null,emit:function(q,p){p=p||[];if(this._listeners[q]){for(var r=0;r<this._listeners[q].length;r++){this._listeners[q][r].apply(this,p)}}return this},on:function(p,q){this._listeners[p]=this._listeners[p]||[];this._listeners[p].push(q);return this},off:function(p,r){if(this._listeners[p]){if(!r){delete this._listeners[p];return this}for(var q=0;q<this._listeners[p].length;q++){if(this._listeners[p][q]===r){this._listeners[p].splice(q--,1)}}this._listeners[p].length||delete this._listeners[p]}return this},once:function(p,r){function q(){this.off(q);return r.apply(this,arguments)}return this.on(p,q)}};function e(p,w){if(!(this instanceof e)){return new e(p,w)}var y=this,s=[],v,u,r,x;if(typeof p==="string"){v=p.split("*:");u=v[v[1]?1:0].split("||");y.id=v[1]?v[0]:u[0];y.alternates=s;for(v=0;v<u.length;v++){r=u[v].split(".");r=r[r.length-1].toLowerCase();x=c[r]?c[r].media:h(r,n.imageTypes)?"image":"document";if(c[r]&&!c[r].supported){continue}s.push({type:x,path:u[v]})}s.length||s.push({type:x,path:u[v-1]})}else{g(w,TypeError("Invalid path"),y);return}function q(){var t=s.shift();t?new e[t.type](t.path,function(A,z){y.dom=z&&z.dom;if(A&&y.alternates.length){return q()}w(A,y)}):g(w,Error("No viable alternatives"),null)}q()}function m(p){return function(s,u){var r=this,t=p();function q(){t.onload=t.onerror=null;t.removeEventListener&&t.removeEventListener("canplaythrough",q,true);u(null,r)}t.addEventListener&&t.addEventListener("canplaythrough",q,true);t.onload=q;t.onerror=function(v){u(v,r)};r.dom=t;t.src=s;t.load&&t.load()}}e.audio=m(i);e.video=m(k);e.image=m(d);e.document=function(q,u){var p=this,r=/(\[(!)?(.+)?\])?$/.exec(q),t=r[3],s=p.dom=new j();if(!s){g(u,Error("No XHR!"),p);return}q=q.substr(0,q.length-r[0].length);q+=r[2]?(q.indexOf("?")===-1?"?":"&")+"fobarz="+(+new Date):"";t&&s.overrideMimeType(t==="@"?"text/plain; charset=x-user-defined":t);s.onreadystatechange=function(){if(s.readyState!==4){return}var v=p.dom=s.responseXML&&s.responseXML.documentElement?s.responseXML:String(s.responseText||"");s.status===200?u(null,p):u({e:Error("Request failed: "+s.status)},p)};s.onerror=function(v){u(v,p)};s.open("GET",q,true);s.send()};(function(){var r=i(),q=k(),p;n.audio=!!r.canPlayType;n.video=!!q.canPlayType;n.audioTypes=[];n.videoTypes=[];for(p in c){if(c.hasOwnProperty(p)){if(c[p].media==="video"){(c[p].supported=n.video&&q.canPlayType(c[p].codec))&&n.videoTypes.push(p)}else{if(c[p].media==="audio"){(c[p].supported=n.audio&&r.canPlayType(c[p].codec))&&n.audioTypes.push(p)}}}}}());if(!n.audio){e.audio=function(p,q){g(q,Error("<AUDIO> not supported."),p)}}if(!n.video){e.video=function(p,q){g(q,Error("<VIDEO> not supported."),p)}}function b(){var p=this,q=arguments;if(!(p instanceof b)){p=new b();q.length&&p.loadFiles.apply(p,q);return p}p.files=[];b.EventEmitter.call(p);p.loadCallback=l(p.loadCallback,p);q.length&&p.loadFiles.apply(p,q)}b.prototype={active:false,files:null,filesLoading:0,filesLoaded:0,loadCallback:function(q,p){this.filesLoaded++;this.emit(q?"error":"fileloaded",q?[q,p]:[p]);if(this.filesLoading-this.filesLoaded===0){this.active=false;this.emit("finish");this.filesLoading=0;this.filesLoaded=0}},getFile:function(p){return typeof p==="undefined"?a(this.files,function(q){return q.dom}):typeof p==="number"?this.files[p].dom:typeof p==="string"?this.files[f+p].dom:null},removeFile:function(r){var q,p;switch(typeof r){case"undefined":this.files=[];break;case"number":q=this.files[r];this.files[f+q.id]&&delete this.files[f+q.id];this.files.splice(r,1);break;case"string":q=this.files[f+r];q&&delete this.files[f+r];for(p=0;p<this.files.length;p++){this.files[p]===q&&this.files.splice(p--,1)}}},loadFiles:function(){var q=[].slice.call(arguments),p,r;for(p=0;p<q.length;p++){r=b.loadFile(q[p],this.loadCallback);this.files.push(r);this.files[f+r.id]=r;this.filesLoading++}this.active=this.active||!!this.filesLoading},addFiles:function(p){return this.loadFiles.apply(this,p instanceof Array?p:arguments)},getProgress:function(){return this.filesLoading?this.filesLoaded/this.filesLoading:1}};b.support=n;b.loadFile=e;b.EventEmitter=o;return b}());
